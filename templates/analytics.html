{% extends 'pagebase.html' %}

{% block body %}


<div class="container-fluid">
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="alert alert-success" role="alert">
          {{ message }}
        </div>
        
        
      {% endfor %}
    {% endif %}
    {% endwith %}
    <br>

    {% if low_quantity_flash %}
    <div class="alert alert-danger" role="alert">
        {{ low_quantity_flash }}
    </div>
{% endif %}
        
<p class="mb-2 text-dark"> Budget Summary</p>
          <div class="row my-2">  
                   
          <div class="col-xl-4 col-sm-3 col-12" style="margin-bottom:20px;  ">
            
            <a href="/analytics" style="text-decoration: none; color: #992621;">
            <div class="card shadow border-1" style="">
                <div class="card-body"> 
                    <div class="row">
                        <div class="col">
                          <div class="d-flex justify-content-between">
                            <span class="h4 m-1 font-semibold d-block mb-2 mb-2">
                              <b> Total Budget </b><br> <span class="h6 text-muted"> Total Amount on Budget</span></span>
                              <i class="bi bi-currency-dollar bg-primary p-2 fs-4  text-light" style="border-radius:5px; height:50px;"></i>
  
                          </div>
                           <hr>
                         <span class="h9 font-bold mb-5" style="font-size:30px; text-align:center;" >$ {{total_budget}}</span>
                        
                         
                        </div>
                        
                    </div>     
                </div>
            </div>
         </a>
        </div>
        <div class="col-xl-4 col-sm-3 col-12" style="margin-bottom:20px;  ">
              
          <a href="/analytics" style="text-decoration: none; color: #992621;">
          <div class="card shadow border-1" style="">
              <div class="card-body"> 
                <div class="row">
                  <div class="col">
                    <div class="d-flex justify-content-between">
                      <span class="h4 m-1 font-semibold d-block mb-2 mb-2">
                        <b> Total Price </b><br> <span class="h6 text-muted"> Total Price</span></span>
                        <i class="bi bi-currency-dollar bg-success p-2 fs-4  text-light" style="border-radius:5px; height:50px;"></i>
  
                    </div>
                     <hr>
                   <span class="h9 font-bold mb-5" style="font-size:30px; text-align:center;" > $ {{ total_amount | int }} </span>
                  
                  
                  </div>
                  
              </div>     
              </div>
          </div>
       </a>
      </div>
      <div class="col-xl-4 col-sm-3 col-12" style="margin-bottom:20px;  ">
              
        <a href="/analytics" style="text-decoration: none; color: #992621;">
        <div class="card shadow border-1" style="">
            <div class="card-body"> 
              <div class="row">
                <div class="col">
                  <div class="d-flex justify-content-between">
                    <span class="h4 m-1 font-semibold d-block mb-2 mb-2">
                      <b> Total Product Amount</b><br> <span class="h6 text-muted">Total Amount Per Unit Product</span></span>
                      <i class="bi bi-currency-dollar bg-warning p-2 fs-4  text-light" style="border-radius:5px; height:50px;"></i>
  
                  </div>
                   <hr>
                 <span class="h9 font-bold mb-5" style="font-size:30px; text-align:center;" >$  {{total_sum}}</span>
                
                
                </div>
                
            </div>  
                    
                </div>     
            </div>
        </div>
     </a>
    </div>

<hr>
   <p class="mb-2 text-dark"> Delivery Summary</p>
    <div class="row g-6 mb-6">
      
      <div class="col-xl-4 col-sm-6 col-12">
          <div class="card shadow border-0">
              <div class="card-body">
                  <div class="row">
                      <div class="col">
                          <span class="h6 font-semibold text-muted text-sm d-block mb-2">All Products</span>
                          <span class="h3 font-bold mb-0">{{total_students}}</span>
                      </div>
                      <div class="col-auto">
                          <div class="icon icon-shape bg-primary text-white text-lg rounded-circle">
                              <i class="bi bi-folder"></i>
                          </div>
                      </div>
                  </div>
                  <div class="mt-2 mb-0 text-sm">
                      {% if total_students < 50 %}
                      <span class="badge badge-pill bg-soft-danger text-danger me-2">
                          <i class="bi bi-arrow-down me-1"></i>Total Product
                      </span>
                      {% elif total_students >= 50 and total_students <= 80 %}
                      <span class="badge badge-pill bg-soft-warning text-warning me-2">
                          <i class="bi bi-dash me-1"></i>Total Product
                      </span>
                      {% else %}
                      <span class="badge badge-pill bg-soft-success text-success me-2">
                          <i class="bi bi-arrow-up me-1"></i>Total Product
                      </span>
                      {% endif %}

                     <!-- <span class="badge badge-pill bg-soft-warning text-warning me-2">
                          <i class="bi bi-arrow-right me-1"></i>Total Product
                      </span>-->
                      <span class="text-nowrap text-xs text-muted"> </span>
                  </div>
              </div>
          </div>
      </div>
      <div class="col-xl-4 col-sm-6 col-12">
          <div class="card shadow border-0">
              <div class="card-body">
                  <div class="row">
                      <div class="col">
                          <span class="h6 font-semibold text-muted text-sm d-block mb-2">WareHouse</span>
                          <span class="h3 font-bold mb-0">{{total_cat}}</span>
                      </div>
                      <div class="col-auto">
                          <div class="icon icon-shape bg-info text-white text-lg rounded-circle">
                              <i class="bi bi-folder"></i>
                          </div>
                      </div>
                  </div>
                  <div class="mt-2 mb-0 text-sm">
                      {% if total_cat < 50 %}
                      <span class="badge badge-pill bg-soft-danger text-danger me-2">
                          <i class="bi bi-arrow-down me-1"></i>My WareHouse
                      </span>
                      {% elif total_cat >= 50 and total_cat <= 80 %}
                      <span class="badge badge-pill bg-soft-warning text-warning me-2">
                          <i class="bi bi-dash me-1"></i>My WareHouse
                      </span>
                      {% else %}
                      <span class="badge badge-pill bg-soft-success text-success me-2">
                          <i class="bi bi-arrow-up me-1"></i>My WareHouse
                      </span>
                      {% endif %}
                     <!-- <span class="badge badge-pill bg-soft-warning text-warning me-2">
                          <i class="bi bi-arrow-right me-1"></i>
                      </span>-->
                      <span class="text-nowrap text-xs text-muted"> </span>
                  </div>
              </div>
          </div>
      </div>
      

     
          <div class="col-xl-4 col-sm-6 col-12">
              <div class="card shadow border-0">
                  <div class="card-body">
                      <div class="row">
                          <div class="col">
                              <span class="h6 font-semibold text-muted text-sm d-block mb-2">Out of Stock</span>
                              <span class="h3 font-bold mb-0">{{ outstock}}</span>
                          </div>
                          <div class="col-auto">
                              <div class="icon icon-shape bg-danger text-white text-lg rounded-circle">
                                  <i class="bi bi-bell-fill"></i>
                              </div>
                          </div>
                      </div>
                      <div class="mt-2 mb-0 text-sm">
                          <span class="badge badge-pill bg-soft-danger text-danger me-2">
                              <i class="bi bi-arrow-down me-1"></i>Out-Of-Stock
                          </span>
                          <span class="text-nowrap text-xs text-muted"> </span>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12">
              <div class="card shadow border-0">
                  <div class="card-body">
                      <div class="row">
                          <div class="col">
                              <span class="h6 font-semibold text-muted text-sm d-block mb-2">In Stock</span>
                              <span class="h3 font-bold mb-0">{{total_stock}}</span>
                          </div>
                          <div class="col-auto">
                              <div class="icon icon-shape bg-success text-white text-lg rounded-circle">
                                  <i class="bi bi-bookmarks"></i>
                              </div>
                          </div>
                      </div>
                      <div class="mt-2 mb-0 text-sm">
                          <span class="badge badge-pill bg-soft-success text-success me-2">
                              <i class="bi bi-arrow-up me-1"></i>In-Stock
                          </span>
                          <span class="text-nowrap text-xs text-muted"> </span>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12">
              <div class="card shadow border-0">
                  <div class="card-body">
                      <div class="row">
                          <div class="col">
                              <span class="h6 font-semibold text-muted text-sm d-block mb-2">Task</span>
                              <span class="h3 font-bold mb-0">{{total_challenges}}</span>
                          </div>
                          <div class="col-auto">
                              <div class="icon icon-shape bg-info text-white text-lg rounded-circle">
                                  <i class="bi bi-clipboard"></i>
                              </div>
                          </div>
                      </div>
                      <div class="mt-2 mb-0 text-sm">
                          {% if total_challenges < 50 %}
                      <span class="badge badge-pill bg-soft-danger text-danger me-2">
                          <i class="bi bi-arrow-down me-1"></i>My Task
                      </span>
                      {% elif total_challenges >= 50 and total_challenges <= 80 %}
                      <span class="badge badge-pill bg-soft-warning text-warning me-2">
                          <i class="bi bi-dash me-1"></i>My Task
                      </span>
                      {% else %}
                      <span class="badge badge-pill bg-soft-success text-success me-2">
                          <i class="bi bi-arrow-up me-1"></i>My Task
                      </span>
                      {% endif %}
                         <!-- <span class="badge badge-pill bg-soft-warning text-warning me-2">
                              <i class="bi bi-arrow-right me-1"></i>
                          </span>-->
                          <span class="text-nowrap text-xs text-muted"> </span>
                      </div>
                  </div>
              </div>
          </div>
          <div class="col-xl-4 col-sm-6 col-12">
              <div class="card shadow border-0">
                  <div class="card-body">
                      <div class="row">
                          <div class="col">
                              <span class="h6 font-semibold text-muted text-sm d-block mb-2">Goals</span>
                              <span class="h3 font-bold mb-0">{{total_Faq}}</span>
                          </div>
                          <div class="col-auto">
                              <div class="icon icon-shape bg-warning text-white text-lg rounded-circle">
                                  <i class="bi bi-clock-history"></i>
                              </div>
                          </div>
                      </div>
                      <div class="mt-2 mb-0 text-sm">
                          {% if total_Faq < 50 %}
                      <span class="badge badge-pill bg-soft-danger text-danger me-2">
                          <i class="bi bi-arrow-down me-1"></i>My Goals
                      </span>
                      {% elif total_Faq >= 50 and total_Faq <= 80 %}
                      <span class="badge badge-pill bg-soft-warning text-warning me-2">
                          <i class="bi bi-dash me-1"></i>My Goals
                      </span>
                      {% else %}
                      <span class="badge badge-pill bg-soft-success text-success me-2">
                          <i class="bi bi-arrow-up me-1"></i>My Goals
                      </span>
                      {% endif %}
                         <!-- <span class="badge badge-pill bg-soft-success text-success me-2">
                              <i class="bi bi-arrow-right me-1"></i>
                          </span>-->
                          <span class="text-nowrap text-xs text-muted"></span>
                      </div>
                  </div>
              </div>
          </div>
      </div>
  </div>
  



 


  


  
  </div>
      
      </div>

  </main>





<script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const lineCtx = document.getElementById('lineChart').getContext('2d');
      const barCtx = document.getElementById('barChart').getContext('2d');

      // Extract data from the Flask context
      const items = {{ items | tojson | safe }};
      let labels = items.map(item => item.start_date);
      const productNames = items.map(item => item.name);
      const prices = items.map(item => item.price);

      // Populate day and month filter options
      populateFilters(items);

      // Create the charts
      let lineChart = createLineChart(labels, prices, productNames);
      let barChart = createBarChart(labels, prices, productNames);

      // Event listeners for filters
      document.getElementById('dayFilter').addEventListener('change', updateCharts);
      document.getElementById('monthFilter').addEventListener('change', updateCharts);

      function updateCharts() {
        const selectedDay = document.getElementById('dayFilter').value;
        const selectedMonth = document.getElementById('monthFilter').value;

        const filteredItems = items.filter(item => {
          const itemDate = new Date(item.start_date);
          const itemDay = itemDate.getDate();
          const itemMonth = itemDate.getMonth() + 1;

          return (!selectedDay || itemDay == selectedDay) &&
                 (!selectedMonth || itemMonth == selectedMonth);
        });

        labels = filteredItems.map(item => item.start_date);
        const filteredPrices = filteredItems.map(item => item.price);
        const filteredProductNames = filteredItems.map(item => item.name);

        // Update the charts with filtered data
        lineChart.destroy();
        barChart.destroy();
        lineChart = createLineChart(labels, filteredPrices, filteredProductNames);
        barChart = createBarChart(labels, filteredPrices, filteredProductNames);
      }

      function createLineChart(labels, prices, productNames) {
        return new Chart(lineCtx, {
          type: 'line',
          data: {
            labels: labels,
            datasets: [{
              label: 'Product Prices',
              data: prices,
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Date'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Price'
                },
                beginAtZero: true
              }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(tooltipItem) {
                    return productNames[tooltipItem.dataIndex] + ': $' + tooltipItem.formattedValue;
                  }
                }
              }
            }
          }
        });
      }

      function createBarChart(labels, prices, productNames) {
        return new Chart(barCtx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Product Prices',
              data: prices,
              backgroundColor: 'rgba(54, 162, 235, 0.2)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            scales: {
              x: {
                title: {
                  display: true,
                  text: 'Date'
                }
              },
              y: {
                title: {
                  display: true,
                  text: 'Price'
                },
                beginAtZero: true
              }
            },
            plugins: {
              tooltip: {
                callbacks: {
                  label: function(tooltipItem) {
                    return productNames[tooltipItem.dataIndex] + ': $' + tooltipItem.formattedValue;
                  }
                }
              }
            }
          }
        });
      }

      function populateFilters(items) {
        const dayFilter = document.getElementById('dayFilter');
        const monthFilter = document.getElementById('monthFilter');

        const days = [...new Set(items.map(item => new Date(item.start_date).getDate()))];
        const months = [...new Set(items.map(item => new Date(item.start_date).getMonth() + 1))];

        days.forEach(day => {
          const option = document.createElement('option');
          option.value = day;
          option.textContent = day;
          dayFilter.appendChild(option);
        });

        months.forEach(month => {
          const option = document.createElement('option');
          option.value = month;
          option.textContent = month;
          monthFilter.appendChild(option);
        });
      }
    });
  </script>



<script>
var idleTime = 0;
var idleInterval = setInterval(timerIncrement, 60000); // 1 minute

$(document).ready(function () {
    console.log("Document ready");
    // Zero the idle timer on mouse movement or keypress
    $(this).mousemove(function (e) {
        idleTime = 0;
        console.log("Mouse moved, idleTime reset to 0");
    });
    $(this).keypress(function (e) {
        idleTime = 0;
        console.log("Key pressed, idleTime reset to 0");
    });
});

function timerIncrement() {
    idleTime++;
    console.log("Idle time incremented to", idleTime);
    if (idleTime > 19) { // 2 minutes
        alert("Your Session will be logged out soon, check out our new AI Feature ðŸ¥³.");
        $.ajax({
            url: "{{ url_for('log_inactivity') }}",
            method: "POST",
            data: JSON.stringify({ message: "User is inactive" }),
            contentType: "application/json",
            success: function(response) {
                console.log("Inactivity logged:", response);
                setTimeout(function() {
                    console.log("Redirecting to logout");
                    window.location.href = "{{ url_for('logout') }}";
                }, 60000); // 1 minute later
            }
        });
    }
}
</script>


<script>
function generateRandomCode() {
    var characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
    var codeLength = 6;
    var code = '';
    for (var i = 0; i < codeLength; i++) {
        var randomIndex = Math.floor(Math.random() * characters.length);
        code += characters.charAt(randomIndex);
    }
    return code;
}

// Generate and display the unique code when the form is submitted
document.getElementById('faqForm').addEventListener('submit', function(event) {
    event.preventDefault();  // Prevent the form from submitting
    var uniqueCode = generateRandomCode();
    document.getElementById('uniqueCode').innerText = 'Unique Code: ' + uniqueCode;
});
</script>

<!-- Bootstrap JavaScript and Popper.js (Order is important) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Triggering the Toast -->
<!-- Your existing HTML code -->

<!-- Bootstrap JS (Make sure to include Popper.js and Bootstrap JS) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

<!-- Your custom JavaScript code -->


<!-- Your existing HTML code -->


<script async="" type="text/javascript" src="https://www.myhealth1st.com.au/mh1-widget/2021/popup.v3.js"></script>
<!-- End of MyHealth1st Widget code -->

<!-- 
- custom js link

<!-- 
- ionicon link
-->
<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
   https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-storage.js"></script>

<!-- <script defer src="//firebase/8.9.1/firebase-storage.js"></script> -->


<script>
document.addEventListener("DOMContentLoaded", function () {
    // Simulate delay for demonstration purposes
    setTimeout(function () {
        // Hide loading screen and display content
        document.getElementById("loadingScreen").style.display = "none";
        document.getElementById("mainContent").style.display = "block";
    }, 2000); // Adjust the delay time as needed
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- Triggering the Toast -->
<!-- <script>
var toastElement = new bootstrap.Toast(document.querySelector('.toast'));
toastElement.show();
</script>-->


<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
   https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.9.1/firebase-storage.js"></script>

<!-- <script defer src="//firebase/8.9.1/firebase-storage.js"></script> -->

<!-- Bootstrap JS (Make sure to include Popper.js and Bootstrap JS) -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

<!-- Your custom JavaScript code -->
<script>
document.addEventListener('DOMContentLoaded', function () {
    var liveToastBtn = document.getElementById('liveToastBtn');
    var liveToast = new bootstrap.Toast(document.getElementById('liveToast'));

    liveToastBtn.addEventListener('click', function () {
        liveToast.show();
    });
});
</script>

<script>
// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBPHDVrXV4nn_4agQgWFItDlS8z9cvq5zw",
  authDomain: "centralalumni.firebaseapp.com",
  projectId: "centralalumni",
  storageBucket: "centralalumni.appspot.com",
  messagingSenderId: "270504690849",
  appId: "1:270504690849:web:b03ee12ab92e157196dce0",
  measurementId: "G-9T21K58F10"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
firebase.analytics();
</script>
<script src="static/assets/js/script.js"></script>

<!-- 
- ionicon link
-->
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-u1OknCvxWvY5kfmNBILK2hRnQC3Pr17a+RTT6rIHI7NnikvbZlHgTPOOmMi466C8" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js" integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous"></script>

{%endblock body%}
