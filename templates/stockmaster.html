<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <title>Stock Master</title>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz4fnFO9gybY1Nyz7mLhYxHkWvD8U4L5ILv0V1F1Wh51kfj3FxzF1XeHf7" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-wwYF3CwZzbsGkgOtAp+8S8VflzR34hz5C40esK4fD6kGhMCCdO0oaUMwRfEyRC+7" crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="static/assets/css/ai.css">
</head>
<body>
    <div class="chat-container">
        <div class="chat-header d-flex">
            <div class="lily">
                <a href="/" style="text-decoration:none;">
                    <i class="fa fa-arrow-left text-dark" style="color:#000; margin-top:25px; margin-right:15px;" aria-hidden="true"></i>
                </a>
                <img src="https://i.pinimg.com/originals/91/16/f7/9116f7fd184238ada99fdff9e2f2e3ac.gif" lazy="loading" style="width:50px; margin-top:10px;  height:50px; object-fit:cover; border-radius:50px;">
                <h2 class="ai h5"><b>Stock Master</b><br><span style="color:green;">Online</span></h2>
            </div>
        </div>

        <div class="chat-body" id="chat-body">
            <span style="margin-top:30px;"><b>Stock Master</b></span>
            <div class="icon"> 
                <img src="https://i.pinimg.com/originals/91/16/f7/9116f7fd184238ada99fdff9e2f2e3ac.gif" style="width:30px; margin-top:10px; height:30px; object-fit:cover; margin-right:10px; border-radius:50px;">
                <div class="message bot">
                    <p>Hello <b>{{current_user.name}}</b>. I'm Stock Master, How can I help you today? </p>
                </div>
            </div>

            {% for entry in data|reverse %}
            <div class="icon"> 
                <img src="https://subbb-images.s3.amazonaws.com/f34b0519-1039-4f1c-83ae-bcc77984ec91-1725367321238-3.jpeg" style="width:30px; margin-top:10px; height:30px; object-fit:cover; margin-right:10px; border-radius:50px;">
                <div class="messages">
                    <p>{{ entry['input'] }}</p>
                </div>
            </div>
            <span style="margin-top:30px;"><b>Stock Master</b></span>
            <div class="icon"> 
                <img src="https://i.pinimg.com/originals/91/16/f7/9116f7fd184238ada99fdff9e2f2e3ac.gif" style="width:30px; margin-top:10px; height:30px; object-fit:cover; margin-right:10px; border-radius:50px;">
                <div class="message bot">
                    <p>{{ entry['result'] }}</p>
                </div>
            </div>
            {% endfor %}
            {% with messages = get_flashed_messages() %}
            {% if messages %}
                {% for message in messages %}
                <div class="alert alert-success mb-3" role="alert">
                    {{ message }}
                </div>
                {% endfor %}
            {% endif %}
            {% endwith %}
        </div>

        <form class="element" method="POST" onsubmit="sendMessage(event)">
            <div class="chat-footer">
                <textarea type="text" name="text" id="chat-input" placeholder="Type your message here..." class="form-control" onkeydown="if(event.keyCode==13){sendMessage(event); return false;}" style=" border-radius:20px;  border:none;">
                </textarea>
                <button id="sendButton" class="send-btn" style="border-radius:50px; width:60px;" type="submit"><i class="fa fa-paper-plane" aria-hidden="true"></i></button>
               
                <input type="file" class="send-btn" style="border-radius:50px; width:60px;" name="receipt_image" id="receipt_image" accept="image/*">
                <!-- <button class="send-btn"  type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#uploadModal">
                    <i class="fa fa-upload" aria-hidden="true"></i>
                </button>-->
               
            </div>
        </form>

        <span class="text-muted" style="text-align:center; font-size:11px; background-color:#f8f7f7;">Stock Master can make mistakes. Check important info. <a href="">Privacy Policy</a></span>
    </div>

    <!-- Upload Modal -->
   <!-- <form method="POST" enctype="multipart/form-data">
        <label for="text">Enter your query:</label>
        <input type="text" name="text" id="text">
        
        <label for="receipt_image">Or upload receipt image:</label>
       
        
        <button type="submit">Submit</button>
    </form>-->

    
    <script>
        // Initial scroll to the bottom on page load
        window.onload = function() {
            const chatBody = document.getElementById('chat-body');
            chatBody.scrollTop = chatBody.scrollHeight;

            // Show the welcome modal on page load
            document.getElementById('welcome-modal').classList.add('show');
        };

        // Hide the modal on "Get Started" or "Cancel" button click
        document.getElementById('get-started-btn').addEventListener('click', function() {
            document.getElementById('welcome-modal').classList.remove('show');
        });

        // Function to add a new message to the chat
        function addMessageToChat(sender, message) {
            const chatBody = document.getElementById('chat-body');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender);
            messageElement.innerHTML = `<p>${message}</p>`;
            chatBody.appendChild(messageElement);

            // Scroll to the bottom of the chat body
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        // Function to handle sending a message
        document.getElementById('sendButton').addEventListener('click', function(event) {
            event.preventDefault(); // Prevent form submission
            const inputField = document.getElementById('chat-input');
            const message = inputField.value.trim();

            if (message !== "") {
                addMessageToChat('user', message);
                inputField.value = '';

                // Simulate bot response
                setTimeout(() => {
                    addMessageToChat('bot', "I'm here to help!");
                }, 1000);
            }
        });
    </script>
</body>
</html>
